import os 
from sage.all import * 
from Crypto.Util.number import bytes_to_long, long_to_bytes

C = ComplexField(2025)

flag = os.getenv('FLAG', 'HCMUS-CTF{https://www.youtube.com/shorts/fM93HlH_uS8}').encode()

flag = flag.lstrip(b'HCMUS-CTF{')[:-1]

def compress(xs): 
    if len(xs) == 1: 
        return xs[0]
    if len(xs) == 2: 
        return (xs[0] ** 2 + xs[1]) * (xs[0] > xs[1]) + (xs[1] ** 2 + xs[1] + xs[0]) * (xs[0] <= xs[1])
    return compress([compress(xs[:len(xs) // 2]), compress(xs[len(xs) // 2:])])

r1 = bytes_to_long(os.urandom(8)) + bytes_to_long(os.urandom(8)) * I 
r2 = bytes_to_long(os.urandom(8)) + bytes_to_long(os.urandom(8)) * I 
PR, (x, y) = C['x, y'].objgens()
fl, ag = list(bytearray(flag[:len(flag)//2])), list(bytearray(flag[len(flag)//2:]))
coeffs = vector(C, fl) + vector(C, ag) * I
k = len(coeffs) 
f = sum(c * x ** (k - i) * y ** i for i, c in enumerate(coeffs))
output = f(r1, r2) 

r = r1.real_part()
r += r1.imag_part() * pow(256, 8) 
r += r2.real_part() * pow(256, 16) 
r += r2.imag_part() * pow(256, 24)
r = long_to_bytes(int(r))
compressed_r = compress(bytearray(r))

print(f"{output = }")
print(f"{compressed_r = }")

"""
output = -5.88527593235489299068321197110162074955398163751677026348878587678198563512096561374433713065788418007265351759191254499302991113598229544074637054969362436335635557283847686469403534264062755064264226760324727413456645593770517369605939554683530971047581959142431251746289551828698583245826835298605177641733689139644823667911326192211991130712173122484560474908703443263144970675699444229343236525361018880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e406 - 1.14510127674642293258768185812190843178685054774447478502029523908515272836942614475637089629555172451193362862404862635674340063873426115607363166955428451778942399828804765252241526029141253661800872342514586580588449781582315239548335257760382190166233624452416993114173278501704273569433411675814950741076865817726888485777410843796570593972670141659275729920647696091038639092879155858055558870844865536000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e407*I
compressed_r = 84077755203692134399464789175892066511565940653195267224311741153937420137712
"""